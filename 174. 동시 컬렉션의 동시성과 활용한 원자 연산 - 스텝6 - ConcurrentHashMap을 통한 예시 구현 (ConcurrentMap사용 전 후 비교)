

char[] characters = str.toCharArray(); 
		for(char character : characters) {
			Integer integer = occurrences.get(character); 
			if(integer == null) {
				occurrences.put(character, 1);
			} else { 
				occurrences.put(character, integer + 1);
			}
ì§€ë‚œ í•™ìŠµì—ì„  ì´ëŸ¬í•œ ì½”ë””ê°€ thread-safeí•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì— ëŒ€í•´ ì´ì•¼ê¸°í•˜ê³ ,
ì´ëŸ¬í•œ ì½”ë“œë¥¼ ë” thread-safeí•˜ê²Œ ë§Œë“¤ê¸° ìœ„í•´ ConcurrentMapì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤ëŠ” ì ì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ë‹¤

ì´ë²ˆ ë‹¨ê³„ì—ì„  ì´ë¥¼ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê² ë‹¤
Hashtableì— ëŒ€í•œ ì˜ˆë¬¸ì„ ì‹¤í–‰í•˜ëŠ” ê²ƒìœ¼ë¡œ ì‹œì‘í•˜ì—¬ ì´ ì˜ˆë¬¸ì„ ConcurrentHashMapì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë°”ê¿”ì£¼ë„ë¡ í•˜ê² ë‹¤


â— ì¼ë°˜ì  Hashtable ì‚¬ìš©ì‹œ
---------------------------------------------------------------------------------------------------


ğŸŸ¢ ConcurrentMapRunner í´ë˜ìŠ¤íŒŒì¼


package concurrency;

import java.util.concurrent.*;
import java.util.concurrent.atomic.*;

public class ConcurrentMapRunner {

	public static void main(String[] args) {
		//1: ê·¸ë¦¬ê³  ì´ì œ Stringì„ ìƒì„±í•´ ë³´ê² ë‹¤ String str = "ABCD ABCD ABCD"ë¼ ì ê² ë‹¤
		//ê·¸ë¦¬ê³  ì´ ì•ˆì— ëª‡ ê°œì˜ characterê°€ ì¡´ì¬í•˜ëŠ”ì§€, ë‹¤ì‹œ ë§í•´ characterê°€ ëª‡ ë²ˆ ë°˜ë³µë˜ëŠ”ì§€ ì•Œì•„ë³´ë„ë¡ í•  ê²ƒì´ë‹¤ ì´í•´í–ˆëƒ?
		//ë³´í†µ ì´ëŸ° ë¬¸ì œë¥¼ í’€ì–´ë‚¼ ë•ŒëŠ” ì£¼ë¡œ ë‹¤ìŒì˜ ë°©ë²•ì„ ì‚¬ìš©í•œë‹¤ Mapì´ë¼ ì ê³  ì‰¼í‘œ ì˜†ì— Long ë˜ëŠ” Integerë¥¼ ì ëŠ”ë‹¤ íŠ¹ì •í•œ characterê°€ ëª‡ ë²ˆ ì €ì¥ë˜ì—ˆëŠ”ì§€ ì°¾ê¸° ìœ„í•´ ì´ë ‡ê²Œ ì ëŠ”ë‹¤ ã…‡ã…‹?
		//ì¼ë°˜ì ìœ¼ë¡œ AtomicIntegerë‚˜ AtomicLongë„ ì‚¬ìš©ì´ ê°€ëŠ¥í•œë°, ì´ìœ ëŠ” increment operationì´ atomicì´ë¼ëŠ” ê²ƒì„ ë³´ì¥í•´ ì£¼ê¸° ë•Œë¬¸ì´ë‹¤ longì„ ì—¬ê¸°ì— ì‚¬ìš©í•œë‹¤ë©´ ë‹¤ì–‘í•œ ì—°ì‚°ì„ í¬í•¨í•˜ë¯€ë¡œ increment operationì€ atomicì´ ì•„ë‹ˆë‹¤
		//ê·¸ëŸ¬ë¯€ë¡œ ë„ˆì—ê²Œ ìƒˆë¡œìš´ í´ë˜ìŠ¤ë¥¼ ì†Œê°œí•˜ê¸° ìœ„í•´ LongAdderë¼ëŠ” ê²ƒì„ ì—¬ê¸° ì‚¬ìš©í•´ ì£¼ë„ë¡ í•˜ê² ë‹¤ ê·¸ë¦¬ê³  ì´ ì˜†ì— occurrances = newë¼ ì ì–´ ì£¼ê²Œê² ë‹¤ Threadsafeí•˜ê³  ì‹¶ë‹¤ë©´, Hashtable<>ë¼ê³  ì ì–´ì£¼ë©´ ëœë‹¤
		Map<Character, LongAdder> occurrances = new Hashtable<>();
		
		String str = "ABCD ABCD ABCD";
		
		//2: ì´ ì—°ì‚°ì„ ì‹¤í–‰í•˜ëŠ” ì¼ë°˜ì ì¸ ë°©ë²•ì€ for(char character:str.toCharArray())ë¥¼ ì ì–´ì£¼ëŠ” ë°©ë²•ì´ë‹¤
		//ê°ê°ì˜ characterì— ëŒ€í•´ ì¡´ì¬ ì—¬ë¶€ë¥¼ í™•ì¸í•´ ì£¼ì–´ì•¼ í•œë‹¤ ê·¸ëŸ¬ë¯€ë¡œ occrrances.get(character) ë¼ ì ì–´ì¤€ë‹¤ LongAdderê°€ ê°™ë‹¤ê³  ì´ì•¼ê¸°í•˜ê³  ìˆë‹¤
		for(char character:str.toCharArray()) {
		
			LongAdder longAdder = occurrances.get(character);
		
			//ë§Œì•½ if(longAdder == null)ì¼ ê²½ìš° ì²˜ë¦¬í•˜ê³  ì‹¶ì€ê²Œ ë­ì§€? longAdder = new LongAdder();ë¼ ì ì–´ì¤€ë‹¤
			if(longAdder == null) {
			longAdder = new LongAdder();
			}
			//longAdder.increment();ë¥¼ ì ì–´ì£¼ê³  ë‚œ ë‹¤ìŒ, occurances.put()ì„ ì ì–´ì¤€ë‹¤ ë§¤ìš° ì¼ë°˜ì ì´ê³  ë³´í¸ì ì¸ ì½”ë“œë¡œ, ì‘ì„±í•˜ëŠ”ë° í° ì–´ë ¤ì›€ì´ ì—†ì„ ê²ƒì´ë‹¤ 
			//ê·¸ë¦¬ê³  ì´ì–´ì„œ ê´„í˜¸ì•ˆì— (character, longAdder)ë¼ ì ì–´ì£¼ê² ë‹¤
			longAdder.increment();
			occurrances.put(character, longAdder);
			//longAdderë¥¼ ì—¬ê¸° ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” ìë™ ì¦ê°€ ì—°ì‚°ì„ ì œê³µí•˜ê¸° ë•Œë¬¸ì´ë‹¤ ì •ìˆ˜ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ i++ë¼ê³  ì ì–´ì¤˜ì•¼ í–ˆì—ˆë‹¤ 
			//ì¦‰, ì´ëŠ” ìë™ì—°ì‚°ì„ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤ ë§ì§€? ë³´ë‹¤ì‹œí”¼ ì´ëŸ°ì‹ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•´ ì£¼ë©´ ëœë‹¤
		}
		//2-1 : ì´ì œ syso(occrances);ë¼ê³  ì ê³  ì‹¤í–‰í•´ë³´ë„ë¡ í•˜ì
		System.out.println(occurrances);
		/* ì¶œë ¥ê²°ê³¼ ==>
		{ =2, A=3, D=3, C=3, B=3}
		ë³´ë‹¤ì‹œí”¼ ë„ì–´ì“°ê¸°ê°€ 2ë²ˆ A 3ë²ˆ, ë‚˜ë¨¸ì§€ ê²ƒë“¤ë„ ëª¨ë‘ 3ë²ˆ ë‚˜ì™”ë‹¤ëŠ” ê²ƒì„ ì•“ ìˆ˜ ìˆë‹¤ ë§ì§€?
		ì´ê²Œ ì¼ë°˜ì ìœ¼ë¡œ ì´ëŸ¬í•œ ëª©ì ì˜ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ë°©ë²•ì´ë‹¤ 
		LongAdder longAdder = occurrances.get(character);
			if(longAdder == null) {
				longAdder = new LongAdder();
			}
			longAdder.increment();
			occurrances.put(character, longAdder);
		í•˜ì§€ë§Œ ì—¬ê¸° ì„¸ ì¤„ì˜ ì½”ë“œë¥¼ ì‚´í´ë³´ë©´, ì´ëŸ¬í•œ ê²ƒë“¤ì„ ê°€ì§€ë¯€ë¡œ thread-safeë¼ê³  í•  ìˆ˜ ì—†ë‹¤
		*/
		//ê·¸ëŸ¬ë¯€ë¡œ ë‘ ê°œì˜ threadê°€ ë™ì‹œì— ì´ ì½”ë“œë¥¼ ì‹¤í–‰í•œë‹¤ê³  í•´ ë³´ê² ë‹¤ ì–´ë–¤ ì¼ì´ ë²Œì–´ì§ˆê¹Œ?
		//ê·¸ë¦¬ê³  ê·¸ ì „ì— characterëŠ” ì´ë¯¸ 5ë²ˆ ë“±ì¥í–ˆë‹¤ê³  ì„¤ì •í•´ ë³´ì ê·¸ëŸ¬ë¯€ë¡œ Thread1ì€ 6ìœ¼ë¡œ ì¦ê°€ì‹œí‚¬ ê²ƒì´ë‹¤
		//ê·¸ë¦¬ê³  Thread2 ë˜í•œ 5ë¼ëŠ” ê°’ì„ ê°–ê³  ìˆì—ˆìœ¼ë¯€ë¡œ, ì´ ë˜í•œ 6ìœ¼ë¡œ ì¦ê°€í•˜ê²Œ ëœë‹¤ 
		//ê·¸ë¦¬ê³  ë³´ë‹¤ì‹œí”¼ updateê°€ ì‚¬ë¼ì¡Œë‹¤ ì´ëŸ¬í•œ ìƒí™©ì´ ë²Œì–´ì§€ëŠ” ê²ƒì„ ì˜ˆë°©í•˜ê¸° ìœ„í•´ ConcurrentHashMapsë¼ëŠ” ê²ƒì´ ì¡´ì¬í•œë‹¤
		//ConcurrentMapì„ ì‚¬ìš©í•˜ê³  ì‹¶ì€ ê²½ìš°, ì´ë ‡ê²Œ í•  ìˆ˜ ìˆë‹¤ //ë‹¤ìŒ ì•„ë˜ë¡œ..
	}

}


---------------------------------------------------------------------------------------------------



â— ConcurrentMap ì‚¬ìš©ì‹œ
---------------------------------------------------------------------------------------------------


ğŸŸ¢ ConcurrentMapRunner í´ë˜ìŠ¤íŒŒì¼



package concurrency;

import java.util.concurrent.*;
import java.util.concurrent.atomic.*;

public class ConcurrentMapRunner {

	public static void main(String[] args) {
		
		//1:ConcurrentMapì„ ì ê³  = ConcurrentHashMapì´ë¼ ì ì–´ì¤€ë‹¤ ì´ì œ ConcurrentMapì„ ì‚¬ìš©í•˜ê³  ìˆë‹¤
		//ConcurrentMapì´ ë³´í†µì˜ Mapì´ ì œê³µí•˜ëŠ” ì—°ì‚°ì„ ëª¨ë‘ ì œê³µí•˜ê³  ìˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œ ìˆ˜ ìˆë‹¤ ë˜í•œ ì¶”ê°€ë¡œ,ConcurrentMapì€ ë‹¤ë¥¸ ë©”ì†Œë“œë„ ì œê³µí•œë‹¤ //3-1: forë¬¸ ì•ˆì—ì„œ ìƒì„±..
		ConcurrentMap<Character, LongAdder> occurrances = new ConcurrentHashMap<>();
		
		String str = "ABCD ABCD ABCD";

		for(char character:str.toCharArray()) {
			
			//2: occurrances.computeIfAbsent()ë¼ê³  ì ì„ìˆ˜ ìˆë‹¤ íŠ¹ì •í•œ keyê°€ characterë¡œì¨ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, mappingFunctionì„ ìƒì„±í•´ ì¤„ ìˆ˜ ìˆë‹¤
			//ëŒë‹¤ì‹ì— ëŒ€í•´ ë°°ìš´ ë‚´ìš©ì„ ë– ì˜¬ë ¤ ë³´ì ì´ë•Œ í•¨ìˆ˜ë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ë°°ì› ë‹¤ ë³´ë‹¤ì‹œí”¼ ì´ê²Œ í•¨ìˆ˜ì¸ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤ ì…ë ¥ê°’ì´ characterê°€ ë˜ê³ , ì¶œë ¥ê°’ì´ LongAdderì´ë‹¤
			//ê·¸ëŸ¬ë¯€ë¡œ ì—¬ê¸°ì„œ characterì˜ chë¥¼ ë”°ì™€ì„œ ê²°ê³¼ê°’ìœ¼ë¡œ new LongAdderë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆë‹¤ ê·¸ëŸ¬ë©´ ì–´ë–¤ ì¼ì„ í•˜ê²Œ ë ê¹Œ? ì¡´ì¬ í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ LongAdderì— ëŒ€í•´ ê°’ì„ ì„¤ì •í•´ ì¤„ ê²ƒì´ë‹¤ ì§€ê¸ˆì€ incrementë¥¼ ì‚¬ìš©í•´ ì¤„ ìˆ˜ ìˆë‹¤
			
      occurrances.computeIfAbsent(character, ch -> new LongAdder()).increment();
			
      //ê·¸ëŸ¬ë¯€ë¡œ ì•„ë˜ì˜ ì½”ë“œë“¤ì€ ëª¨ë‘ í•„ìš” ì—†ë‹¤ (ì‚­ì œ) incrementì™€ putì´ ì‘ì—…ì„ í•´ì¤€ë‹¤
			//ì´ì œ ì´ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì—¬ ê²°ê³¼ë¥¼ ê´€ì°°í•˜ì //3: ì‹¤í–‰í•˜ì
			

//			LongAdder longAdder = occurrances.get(character);     ==> ConcurrentMap ì‚¬ìš©í•˜ë©´ í•„ìš”ì—†ëŠ” ì½”ë“œë“¤
//			if(longAdder == null) {
//				longAdder = new LongAdder();
//			}
//			longAdder.increment();
//			occurrances.put(character, longAdder);

		}
		System.out.println(occurrances);	
		/*3: ConcurrentMap ë³€ê²½í›„ ì‹¤í–‰ê²°ê³¼ ==>
		{ =2, A=3, B=3, C=3, D=3}
		ê²°ê³¼ì—ëŠ” ë³€í•¨ì´ ì—†ë‹¤
		ê·¸ëŸ¬ë¯€ë¡œ ì „ì— ì—¬ê¸° ìˆë˜ ì½”ë“œë“¤ì€ ì´ì œ atomicì—°ì‚°ìœ¼ë¡œ ëŒ€ì²´ë˜ì—ˆë‹¤
		ê·¸ë¦¬ê³  ì´ê²Œ Concurrent Collectionì˜ ì§„ì •í•œ ë§¤ë ¥ì´ë‹¤ Concurrent Collectionì€ ì¥í™©í•œ ë‹¨ê³„ë“¤ì„ ê±°ì³ì•¼ í•˜ëŠ” ì—°ì‚°ì„ 
		atomic ì—°ì‚°ìœ¼ë¡œ ë³€í™˜í•´ ì¤€ë‹¤
		*/
	}

}

---------------------------------------------------------------------------------------------------
